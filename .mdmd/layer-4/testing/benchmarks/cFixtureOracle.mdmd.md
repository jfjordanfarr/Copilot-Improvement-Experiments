# C Fixture Oracle

## Metadata
- Layer: 4
- Implementation ID: IMP-521
- Code Path: [`packages/shared/src/testing/fixtureOracles/cFixtureOracle.ts`](../../../../packages/shared/src/testing/fixtureOracles/cFixtureOracle.ts)
- Exports: COracleEdgeRelation, COracleEdge, COracleProvenance, CFixtureOracleOptions, COracleOverrideEntry, COracleOverrideConfig, COracleEdgeRecord, COracleSegmentPartition, COracleMergeResult, generateCFixtureGraph, partitionCOracleSegments, mergeCOracleEdges, serializeCOracleEdges

## Purpose
Provide a deterministic edge oracle for C benchmarks by statically analysing translation units, collecting `#include` directives, and mapping inter-file function calls into ripple-ready dependency edges.
- Reuse the shared oracle contract so regeneration tooling can call `--lang c` without bespoke glue code.
- Preserve manual overrides for macros or generated headers while still surfacing drift through diff artefacts.
- Produce provenance-aware JSON output that AST benchmarks and telemetry can ingest alongside existing TypeScript and Python fixtures.

## Public Symbols
### COracleEdgeRelation
Enumerates the "includes" and "calls" relationship kinds emitted by the oracle so downstream tooling can differentiate header inclusions from runtime usage.

### COracleEdge
Canonical edge tuple containing fixture-relative source, target, and relation values aligned with benchmark expectations.

### COracleProvenance
Annotates each edge with discovery metadata (`"source-include"`, `"function-call"`, `"manual-override"`) to explain how the dependency was resolved.

### CFixtureOracleOptions
Configuration contract accepted by the oracle, including the fixture root plus optional include/exclude hints that constrain which `.c`/`.h` files are scanned.

### COracleOverrideEntry
Manual edge descriptor enabling authors to assert relationships that static analysis cannot see (macro-generated includes, dynamic `dlsym` calls).

### COracleOverrideConfig
Collection of override entries loaded from `oracle.overrides.json` so regeneration runs can reconcile manual expectations with oracle output.

### COracleEdgeRecord
JSON-friendly representation of an oracle edge used when writing deterministic fixture files.

### COracleSegmentPartition
Helper structure that separates autogenerated edges, matched overrides, and missing overrides for reviewer visibility.

### COracleMergeResult
Aggregate payload combining deduplicated edges, unresolved overrides, and provenance stats returned to regeneration tooling.

### generateCFixtureGraph
Main entry point that walks the fixture directory, strips comments from `.c` files, extracts local `#include "…"` targets, discovers function definitions, and correlates intra-project call sites to produce ordered `COracleEdge` entries with provenance.

### partitionCOracleSegments
Matches raw oracle edges against manual overrides, flagging stale overrides before fixtures are rewritten.

### mergeCOracleEdges
Combines oracle output and overrides, deduplicates relationships, and returns review metadata consumed by CLI diff reports.

### serializeCOracleEdges
Normalises merged edges into canonical JSON—sorting records, trimming environment-specific paths, and emitting provenance summaries.

## Collaborators
- [`scripts/fixture-tools/regenerate-benchmarks.ts`](../../../../scripts/fixture-tools/regenerate-benchmarks.ts) invokes the oracle during `npm run fixtures:regenerate -- --lang c` runs and writes review artefacts.
- [`tests/integration/benchmarks/fixtures/c/`](../../../../tests/integration/benchmarks/fixtures/c/) stores curated expectations exercised by `tests/integration/benchmarks/astAccuracy.test.ts`.
- [`packages/shared/src/inference/fallbackInference.ts`](../../../../packages/shared/src/inference/fallbackInference.ts) consumes oracle output to validate language-aware heuristics.

## Linked Components
- [COMP-007 Diagnostics Benchmarking](../../../layer-3/benchmark-telemetry-pipeline.mdmd.md#comp007-diagnostics-benchmarking)
- [COMP-013 Polyglot Fixture Oracles](../../../layer-3/polyglot-oracles-and-sampling.mdmd.md#comp-013-polyglot-fixture-oracles)

## Evidence
- [`packages/shared/src/testing/fixtureOracles/cFixtureOracle.test.ts`](../../../../packages/shared/src/testing/fixtureOracles/cFixtureOracle.test.ts) exercises include/call discovery, override reconciliation, and serialization determinism.
- `npm run test:benchmarks -- --suite ast` will incorporate C fixtures and confirm precision/recall parity with curated expectations.
- Benchmark telemetry updates in `reports/benchmarks/ast/ast-accuracy.json` will log C-language coverage percentages and regression warnings.
