# Rust Fixture Oracle

## Metadata
- Layer: 4
- Implementation ID: IMP-522
- Code Path: [`packages/shared/src/testing/fixtureOracles/rustFixtureOracle.ts`](../../../../packages/shared/src/testing/fixtureOracles/rustFixtureOracle.ts)
- Exports: RustOracleEdgeRelation, RustOracleEdge, RustOracleProvenance, RustFixtureOracleOptions, RustOracleOverrideEntry, RustOracleOverrideConfig, RustOracleEdgeRecord, RustOracleSegmentPartition, RustOracleMergeResult, generateRustFixtureGraph, partitionRustOracleSegments, mergeRustOracleEdges, serializeRustOracleEdges

## Purpose
Deliver deterministic dependency graphs for Rust benchmarks by statically interpreting `mod` declarations, `use` paths, and explicit module references while respecting curated overrides for macro-expanded edges.
- Align oracle output with ripple semantics so benchmark comparisons remain apples-to-apples with runtime diagnostics.
- Retain language-specific provenance (module reference, use statement, manual override) to support targeted telemetry and override workflows.
- Feed regenerated fixtures into accuracy reports before LLM sampling proposes cross-language relationships, with a future upgrade path to pipe in `cargo metadata`/`rust-analyzer` data when available in the workspace.

## Public Symbols
### RustOracleEdgeRelation
Defines the `"uses"` and `"imports"` relationship kinds emitted by the oracle so ripple tooling can differentiate symbol references from module imports.

### RustOracleEdge
Fixture-relative edge tuple aligning with benchmark expectations and ripple ingestion formats.

### RustOracleProvenance
Captures discovery mode (`"module-declaration"`, `"use-statement"`, `"manual-override"`) for each edge to aid reviewer reasoning.

### RustFixtureOracleOptions
Options bag containing the fixture root plus optional include/exclude globs that constrain which `.rs` files enter the oracle pass.

### RustOracleOverrideEntry
Manual descriptor for edges revealed only at runtime (for example, plugin registries) or by macro expansion heuristics.

### RustOracleOverrideConfig
Override manifest loader ensuring regeneration respects hand-authored expectations.

### RustOracleEdgeRecord
Normalised record written to JSON fixtures for deterministic diffs.

### RustOracleSegmentPartition
Separates autogenerated edges, satisfied overrides, and missing overrides to aid regeneration reports.

### RustOracleMergeResult
Aggregated merge outcome (deduplicated edges, unresolved overrides, provenance stats) handed back to CLI tooling.

### generateRustFixtureGraph
Scans source files, resolves `mod` declarations, interprets `use` paths, and inspects `module::symbol` references to assemble ordered `RustOracleEdge` items with provenance.

### partitionRustOracleSegments
Matches oracle output to overrides, surfacing stale expectations before fixtures are updated.

### mergeRustOracleEdges
Combines oracle edges with manual overrides, deduplicating as needed and surfacing outstanding override work.

### serializeRustOracleEdges
Normalises merged edges for JSON output, including stable ordering and provenance summaries.

## Collaborators
- [`scripts/fixture-tools/regenerate-benchmarks.ts`](../../../../scripts/fixture-tools/regenerate-benchmarks.ts) (post-refactor) invokes the oracle when `--lang rust` is requested.
- [`tests/integration/benchmarks/fixtures/rust/`](../../../../tests/integration/benchmarks/fixtures/rust/) stores curated expectations validated by the AST accuracy suite.
- [`packages/shared/src/inference/fallbackInference.ts`](../../../../packages/shared/src/inference/fallbackInference.ts) gains regression tests that compare heuristic output to oracle truth for Rust-specific constructs.

## Linked Components
- [COMP-007 Diagnostics Benchmarking](../../../layer-3/benchmark-telemetry-pipeline.mdmd.md#comp007-diagnostics-benchmarking)
- [COMP-013 Polyglot Fixture Oracles](../../../layer-3/polyglot-oracles-and-sampling.mdmd.md#comp-013-polyglot-fixture-oracles)

## Evidence
- [`packages/shared/src/testing/fixtureOracles/rustFixtureOracle.test.ts`](../../../../packages/shared/src/testing/fixtureOracles/rustFixtureOracle.test.ts) covers module/use parsing heuristics, override reconciliation, and serialization determinism.
- AST benchmark runs (`npm run test:benchmarks -- --suite ast`) will record Rust precision/recall and highlight divergence from curated expectations as heuristics improve.
- Telemetry snapshots in `reports/benchmarks/ast/ast-accuracy.json` will log Rust coverage percentages and drift alerts.
